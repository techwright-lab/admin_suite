<% resources = Array(panel_eval(panel.options[:resources])) %>
<% variant = (panel.options[:variant] || :default).to_sym %>

<div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden">
  <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
    <h3 class="font-semibold text-slate-900 dark:text-white"><%= panel.title %></h3>
  </div>

  <% if resources.any? %>
    <% if variant == :portals %>
      <div class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <% resources.each do |portal_item| %>
          <%
            key = portal_item[:key] || portal_item["key"]
            label = portal_item[:label] || portal_item["label"]
            description = portal_item[:description] || portal_item["description"]
            path = portal_item[:path] || portal_item["path"]
            icon = portal_item[:icon] || portal_item["icon"]
            color = (portal_item[:color] || portal_item["color"] || "slate").to_s
            count = portal_item[:count] || portal_item["count"]
            count_value = count.is_a?(Proc) ? panel_eval(count) : count
          %>

          <%= link_to(path || "#", class: "group block rounded-xl border border-slate-200 dark:border-slate-700 bg-#{color}-50/60 dark:bg-#{color}-900/10 p-4 hover:shadow-sm transition-all") do %>
            <div class="flex items-start justify-between gap-3">
              <div class="flex items-center justify-center w-10 h-10 rounded-xl bg-#{color}-100 dark:bg-#{color}-900/30 flex-shrink-0">
                <%= admin_suite_icon(icon.presence || key.to_s, class: "w-5 h-5 text-#{color}-700 dark:text-#{color}-300") %>
              </div>
              <% if count_value.present? %>
                <span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-white/60 dark:bg-slate-800/60 border border-slate-200/50 dark:border-slate-700/50 text-slate-700 dark:text-slate-200">
                  <%= count_value %>
                </span>
              <% end %>
            </div>

            <div class="mt-3">
              <div class="text-sm font-semibold text-slate-900 dark:text-white group-hover:text-#{color}-700 dark:group-hover:text-#{color}-300">
                <%= label %>
              </div>
              <% if description.present? %>
                <div class="mt-1 text-xs text-slate-600 dark:text-slate-400 line-clamp-2">
                  <%= description %>
                </div>
              <% end %>
            </div>

            <div class="mt-3 inline-flex items-center gap-1 text-sm font-medium text-#{color}-700 dark:text-#{color}-300">
              Enter Portal
              <%= admin_suite_icon("chevron-right", class: "w-4 h-4") %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
      <% resources.each do |resource_item| %>
        <%
          if resource_item.is_a?(Hash)
            label = resource_item[:label] || resource_item["label"]
            description = resource_item[:description] || resource_item["description"]
            resource_name = resource_item[:resource_name] || resource_item["resource_name"]
            path = resource_item[:path] || resource_item["path"]
            count = resource_item[:count] || resource_item["count"]
            icon = resource_item[:icon] || resource_item["icon"]
          else
            resource_name = resource_item.to_s
            label = resource_name.humanize
            description = "Resource"
            path = nil
            count = nil
            icon = nil
          end

          path ||= (resources_path(portal: @portal_key, resource_name: resource_name.to_s) rescue nil)
          path = path.is_a?(Proc) ? panel_eval(path) : path
          count_value = count.is_a?(Proc) ? panel_eval(count) : count
        %>
        <%= link_to(path || "#", class: "block rounded-lg border border-slate-200 dark:border-slate-700 p-4 hover:border-#{theme_primary}-300 dark:hover:border-#{theme_primary}-700 hover:shadow-sm transition-all group") do %>
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <div class="text-sm font-medium text-slate-900 dark:text-white group-hover:text-<%= theme_primary %>-600 dark:group-hover:text-<%= theme_primary %>-400 truncate">
                <span class="inline-flex items-center gap-2">
                  <% if icon.present? %>
                    <%= admin_suite_icon(icon, class: "w-4 h-4 text-slate-400 group-hover:text-#{theme_primary}-500") %>
                  <% end %>
                  <%= label %>
                </span>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 truncate"><%= description %></div>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
              <% if count_value.present? %>
                <span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200">
                  <%= count_value %>
                </span>
              <% end %>
              <%= admin_suite_icon("chevron-right", class: "w-4 h-4 text-slate-300 dark:text-slate-600 group-hover:text-#{theme_primary}-500") %>
            </div>
          </div>
        <% end %>
      <% end %>
      </div>
    <% end %>
  <% else %>
    <div class="p-4 text-sm text-slate-500 dark:text-slate-400">No cards configured.</div>
  <% end %>
</div>
