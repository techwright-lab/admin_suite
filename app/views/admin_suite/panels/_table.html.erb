<% rows_value = panel_eval(panel.options[:rows]) %>
<% rows = Array(rows_value) %>
<% columns = Array(panel.options[:columns]).presence %>

<div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden lg:col-span-3">
  <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
    <h3 class="font-semibold text-slate-900 dark:text-white"><%= panel.title %></h3>
  </div>

  <% if rows.any? %>
    <% columns ||= rows.first.respond_to?(:attributes) ? rows.first.attributes.keys.first(6).map(&:to_sym) : [] %>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
        <thead class="bg-slate-50/50 dark:bg-slate-900/30">
          <tr>
            <% columns.each do |col| %>
              <th class="px-4 py-2.5 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider"><%= col.to_s.humanize %></th>
            <% end %>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
          <% rows.each do |row| %>
            <tr class="hover:bg-slate-50/50 dark:hover:bg-slate-900/30">
              <% columns.each do |col| %>
                <% val = row.respond_to?(col) ? (row.public_send(col) rescue nil) : (row[col] rescue nil) %>
                <td class="px-4 py-3 text-sm text-slate-700 dark:text-slate-200"><%= format_table_cell(val) rescue val.to_s %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="p-4 text-sm text-slate-500 dark:text-slate-400">No rows.</div>
  <% end %>
</div>
