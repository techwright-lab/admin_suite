<%# JSON Editor Field for Admin Suite Forms
    Parameters:
    - f: Form builder object (required)
    - field: FieldDefinition object (required)
    - resource: The resource being edited (required)
-%>
<%
  value = resource.public_send(field.name)
  rows = field.rows || 10
  formatted_value = if value.is_a?(Hash) || value.is_a?(Array)
    JSON.pretty_generate(value)
  elsif value.present?
    value.to_s
  else
    "{}"
  end
%>

<div data-controller="admin-suite--json-editor">
  <% if field.help.present? %>
    <p class="text-sm text-slate-500 dark:text-slate-400 mb-2"><%= field.help %></p>
  <% else %>
    <p class="text-sm text-slate-500 dark:text-slate-400 mb-2">Enter valid JSON. Use the Format button to pretty-print.</p>
  <% end %>

  <div class="relative">
    <%= f.text_area field.name,
        rows: rows,
        class: "form-input w-full font-mono text-sm",
        value: formatted_value,
        readonly: field.readonly,
        data: {
          "admin-suite--json-editor-target": "input",
          action: "input->admin-suite--json-editor#validate"
        } %>

    <div class="absolute top-2 right-2">
      <button
        type="button"
        data-action="click->admin-suite--json-editor#format"
        class="px-3 py-1.5 text-xs font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors"
      >
        Format JSON
      </button>
    </div>
  </div>

  <div
    data-admin-suite--json-editor-target="error"
    class="hidden mt-2 text-sm text-red-600 dark:text-red-400"
  ></div>
</div>
