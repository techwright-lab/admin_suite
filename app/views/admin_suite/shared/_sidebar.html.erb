<%# Admin Suite Sidebar - mirrors internal/developer styling %>

<% sorted_portals = navigation_items.sort_by { |(_key, meta)| (meta[:order] || 100).to_i } %>

<aside class="admin-suite-sidebar flex flex-col w-72 h-full"
       style="background: linear-gradient(to bottom, var(--admin-suite-sidebar-from, #312e81), var(--admin-suite-sidebar-via, #3730a3), var(--admin-suite-sidebar-to, #581c87));">
  <!-- Header -->
  <div class="flex items-center justify-between h-16 px-4 border-b border-white/10">
    <%= link_to root_path, class: "flex items-center gap-3" do %>
      <div class="flex items-center justify-center w-9 h-9 rounded-lg bg-white/10 border border-white/15">
        <%= admin_suite_icon("code", class: "w-5 h-5 text-white") %>
      </div>
      <div>
        <span class="text-lg font-bold text-white">Developer</span>
        <span class="block text-xs text-white/80">Admin Suite</span>
      </div>
    <% end %>
  </div>

  <!-- Quick Links -->
  <div class="px-3 py-3 border-b border-white/10">
    <div class="flex gap-2">
      <%= link_to root_path,
          class: "flex-1 px-3 py-2 text-xs font-medium text-white bg-white/10 rounded-lg hover:bg-white/20 text-center transition-colors" do %>
        Dashboard
      <% end %>
      <% docs = AdminSuite.config.docs_url %>
      <% docs_url = docs.respond_to?(:call) ? docs.call(self) : docs %>
      <% if docs_url.present? %>
        <%= link_to docs_url,
            class: "flex-1 px-3 py-2 text-xs font-medium text-white bg-white/10 rounded-lg hover:bg-white/20 text-center transition-colors",
            target: "_blank",
            rel: "noopener noreferrer" do %>
          Docs
        <% end %>
      <% else %>
        <%= link_to docs_path,
            class: "flex-1 px-3 py-2 text-xs font-medium text-white bg-white/10 rounded-lg hover:bg-white/20 text-center transition-colors" do %>
          Docs
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Portal Navigation -->
  <nav class="flex-1 overflow-y-auto px-3 py-4 space-y-2">
    <% sorted_portals.each do |portal_key, portal| %>
      <% portal_home = portal_path(portal: portal_key).to_s %>
      <% portal_prefix = portal_home.sub(%r{/*\z}, "") %>
      <% active = portal_prefix.present? && (request.path == portal_prefix || request.path.start_with?("#{portal_prefix}/")) %>
      <% color = portal_color(portal_key) %>

      <div>
        <%= link_to (portal_prefix.presence || root_path),
            class: "flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors #{active ? "bg-white/20 text-white" : "text-white/90 hover:bg-white/10 hover:text-white"}" do %>
          <div class="admin-suite-portal-accent admin-suite-portal-accent--<%= color %> admin-suite-portal-chip flex items-center justify-center w-8 h-8 rounded-lg <%= active ? "" : "bg-white/10" %>">
            <%= portal_icon(portal_key, class: "admin-suite-portal-icon w-4 h-4") %>
          </div>
          <span class="font-medium"><%= portal[:label] %></span>
        <% end %>

        <% if active %>
          <div class="mt-1 ml-11 space-y-0.5 text-sm">
            <% portal[:sections].sort_by { |(_k, s)| s[:label].to_s }.each do |_section_key, section| %>
              <div class="text-xs font-medium text-white/70 uppercase tracking-wider px-3 pt-2 pb-1">
                <%= section[:label] %>
              </div>
              <% section[:items].sort_by { |it| [ (it[:order] || 100).to_i, it[:label].to_s ] }.each do |item| %>
                <% item_active = request.path.start_with?(item[:path].to_s) %>
                <%= link_to item[:path],
                    class: "flex items-center gap-2 px-3 py-1.5 rounded #{item_active ? "text-white bg-white/20" : "text-white/90 hover:bg-white/10 hover:text-white"}",
                    data: { turbo_frame: "_top" } do %>
                  <% if item[:icon].present? %>
                    <%= admin_suite_icon(item[:icon], class: "w-3.5 h-3.5 text-white/90") %>
                  <% end %>
                  <span class="truncate"><%= item[:label] %></span>
                <% end %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </nav>

  <!-- Footer -->
  <div class="p-3 border-t border-white/10">
    <div class="px-3 py-2 text-xs text-white/70">
      <div class="flex items-center justify-between">
        <span>Admin Suite</span>
        <span class="font-medium text-white/90"><%= sorted_portals.size %> Portals</span>
      </div>
    </div>
  </div>
</aside>
