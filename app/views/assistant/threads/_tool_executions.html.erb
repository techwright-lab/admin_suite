<%# locals: thread, tool_proposals, tool_executions %>
<div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
  <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
    <div class="text-sm font-semibold text-gray-900 dark:text-white">Tool actions</div>
    <div class="text-xs text-gray-500 dark:text-gray-400">Proposed actions require confirmation.</div>
  </div>

  <div class="p-4 space-y-3">
    <% if tool_proposals.any? %>
      <% tool_proposals.each do |te| %>
        <div class="p-3 rounded-lg border border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/10">
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
              <div class="text-sm font-medium text-amber-900 dark:text-amber-200">
                <%= te.tool_key %>
              </div>
              <div class="mt-1 text-xs text-amber-800 dark:text-amber-300 font-mono break-all">
                trace_id: <%= te.trace_id %>
              </div>
            </div>
            <div class="flex items-center gap-2 whitespace-nowrap">
              <% if te.requires_confirmation? && te.approved_by_id.nil? %>
                <%= button_to "Approve", approve_assistant_thread_tool_execution_path(thread, te), method: :post, class: "px-3 py-1.5 text-xs font-medium bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors" %>
              <% else %>
                <%= button_to "Execute", enqueue_assistant_thread_tool_execution_path(thread, te), method: :post, class: "px-3 py-1.5 text-xs font-medium bg-gray-900 hover:bg-gray-800 text-white rounded-lg transition-colors" %>
              <% end %>
            </div>
          </div>
          <% if te.args.present? %>
            <pre class="mt-2 text-xs bg-white/60 dark:bg-black/20 border border-amber-200/60 dark:border-amber-800/60 rounded-lg p-2 overflow-x-auto"><%= JSON.pretty_generate(te.args) %></pre>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <div class="text-sm text-gray-600 dark:text-gray-400">
        No pending tool actions.
      </div>
    <% end %>

    <% if tool_executions.any? %>
      <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
        <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">Recent</div>
        <div class="space-y-2">
          <% tool_executions.first(8).each do |te| %>
            <div class="flex items-center justify-between text-xs">
              <div class="text-gray-700 dark:text-gray-300">
                <span class="font-mono"><%= te.tool_key %></span>
                <span class="text-gray-400">Â·</span>
                <span class="font-mono"><%= te.status %></span>
              </div>
              <div class="text-gray-400 font-mono"><%= te.created_at.strftime("%H:%M:%S") %></div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
