<div class="w-full px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
          Interview Applications
        </h1>
        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
          Track and manage your job applications
        </p>
      </div>

      <div class="flex items-center gap-3">
        <!-- View Switcher -->
        <%= render "shared/view_switcher", current_view: @current_view %>

        <!-- Add Application Button (Opens Modal) -->
        <button
          type="button"
          onclick="document.getElementById('new-application-modal').dispatchEvent(new CustomEvent('modal:show'))"
          class="
            inline-flex items-center px-4 py-2 bg-primary-600
            hover:bg-primary-700 text-white font-medium rounded-lg
            transition-colors duration-200 shadow-sm hover:shadow
          "
        >
          <svg
            class="w-5 h-5 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          Add Application
        </button>
      </div>
    </div>
  </div>

  <!-- Status Tabs + Filters Row -->
  <% current_status = params[:status].presence || "all" %>
  <% all_count = (@status_counts || {}).values.sum %>
  <% tabs = [
    { key: "all", label: "All", count: all_count },
    { key: "active", label: "Active", count: (@status_counts || {})["active"] || 0 },
    { key: "archived", label: "Archived", count: (@status_counts || {})["archived"] || 0 },
    { key: "rejected", label: "Rejected", count: (@status_counts || {})["rejected"] || 0 },
    { key: "accepted", label: "Accepted", count: (@status_counts || {})["accepted"] || 0 },
    { key: "deleted", label: "Deleted", count: @deleted_count || 0 }
  ] %>

  <div class="mb-6 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
    <!-- Status Tabs -->
    <div class="overflow-x-auto flex-shrink-0">
      <nav class="inline-flex rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-1 gap-1">
        <% tabs.each do |tab| %>
          <% tab_status = (tab[:key] == "all" ? nil : tab[:key]) %>
          <% is_current = current_status == tab[:key] %>
          <%= link_to interview_applications_path(status: tab_status, view: (tab[:key] == "deleted" ? "table" : @current_view)),
              class: [
                "inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-sm font-medium whitespace-nowrap transition-colors",
                (is_current ? "bg-primary-600 text-white" : "text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700")
              ].join(" ") do %>
            <span><%= tab[:label] %></span>
            <span class="<%= is_current ? "bg-white/20 text-white" : "bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200" %> inline-flex items-center justify-center min-w-[1.25rem] h-5 px-1 rounded-full text-xs font-semibold">
              <%= tab[:count] %>
            </span>
          <% end %>
        <% end %>
      </nav>
    </div>
    
    <!-- Inline Filters -->
    <% if @current_view == "table" %>
      <%= form_with url: interview_applications_path, method: :get, data: { controller: "live-filter", turbo_frame: "applications-list", turbo_action: "replace" }, class: "flex flex-wrap items-center gap-2" do |form| %>
        <%= form.hidden_field :status, value: params[:status] %>
        <%= form.hidden_field :view, value: params[:view] || "table" %>
        
        <!-- Search (expands on focus) -->
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-2.5 flex items-center pointer-events-none">
            <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <%= form.text_field :q,
              value: params[:q],
              placeholder: "Search...",
              data: { 
                live_filter_target: "input",
                action: "input->live-filter#debounceWithMinLength",
                live_filter_min_length_value: 2
              },
              class: "w-32 sm:w-36 focus:w-56 sm:focus:w-64 transition-all duration-200 ease-out pl-8 pr-7 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
          <% if params[:q].present? %>
            <button type="button" data-action="click->live-filter#clear" class="absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
              <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          <% end %>
        </div>
        
        <!-- Pipeline Stage -->
        <div class="relative">
          <%= form.select :pipeline_stage,
              options_for_select([
                ["All stages", ""],
                ["Applied", "applied"],
                ["Screening", "screening"],
                ["Interviewing", "interviewing"],
                ["Offer", "offer"],
                ["Closed", "closed"]
              ], params[:pipeline_stage]),
              {},
              data: { action: "change->live-filter#submit" },
              class: "appearance-none pl-2.5 pr-7 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 cursor-pointer" %>
          <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
            <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>

        <!-- Date Range (hidden on small screens) -->
        <div class="hidden md:flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400">
          <%= form.date_field :date_from,
              value: params[:date_from],
              title: "From date",
              data: { action: "change->live-filter#submit" },
              class: "w-32 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
          <span>â€“</span>
          <%= form.date_field :date_to,
              value: params[:date_to],
              title: "To date",
              data: { action: "change->live-filter#submit" },
              class: "w-32 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
        </div>
        
        <!-- Clear filters -->
        <% if params[:q].present? || params[:pipeline_stage].present? || params[:date_from].present? || params[:date_to].present? %>
          <%= link_to interview_applications_path(status: params[:status], view: params[:view]),
              data: { turbo_frame: "applications-list" },
              class: "inline-flex items-center gap-1 px-2 py-1.5 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" do %>
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            <span class="hidden sm:inline">Clear</span>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <!-- Applications View -->
  <% if @applications.any? || @current_view == "table" %>
    <% if @current_view == "kanban" %>
      <%= render "kanban_view" %>
    <% else %>
      <%= render "table_view" %>
    <% end %>
  <% else %>
    <%= render "empty_state" %>
  <% end %>
</div>

<!-- New Application Modal -->

<%= render "interview_applications/new_application_modal" %>

<!-- Include Creation Modals -->

<%# = render "shared/company_create_modal" %>

<%# = render "shared/job_role_create_modal" %>
