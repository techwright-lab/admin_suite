<% if @current_opportunity.present? %>
  <div class="w-full max-w-2xl mx-auto" data-opportunities-target="stack">
    <div class="relative">
      <!-- Background cards (stack effect) -->
      <% if @remaining_count && @remaining_count > 0 %>
        <!-- Third card (furthest back) -->
        <% if @remaining_count >= 2 %>
          <div
            class="
              absolute inset-0 bg-white dark:bg-gray-800 rounded-2xl shadow-lg
              transform translate-y-4 scale-[0.94] opacity-60
            "
          ></div>
        <% end %>
        <!-- Second card -->
        <div
          class="
            absolute inset-0 bg-white dark:bg-gray-800 rounded-2xl shadow-lg
            transform translate-y-2 scale-[0.97] opacity-80
          "
        ></div>
      <% end %>

      <!-- Current card (front) -->
      <div
        id="opportunity_card_<%= @current_opportunity.id %>"
        class="
          relative bg-white dark:bg-gray-800 rounded-2xl shadow-xl
          transition-all duration-300
        "
        data-opportunities-target="currentCard"
        data-opportunity-id="<%= @current_opportunity.id %>"
      >
        <%= render "opportunities/card", opportunity: @current_opportunity, show_actions: true %>
      </div>
    </div>

    <!-- Navigation controls -->
    <div class="mt-6 flex items-center justify-center gap-4">
      <%= link_to opportunities_path(opportunity_id: @prev_opportunity_id),
        class: "inline-flex items-center justify-center px-6 py-3 text-base font-semibold rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors #{'opacity-50 pointer-events-none' if @prev_opportunity_id.blank?}",
        data: { turbo_frame: "opportunities_stack" } do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Prev
      <% end %>

      <span class="text-sm font-medium text-gray-500 dark:text-gray-400 tabular-nums">
        <%= @current_position %>/<%= @total_count %>
      </span>

      <%= link_to opportunities_path(opportunity_id: @next_opportunity_id),
        class: "inline-flex items-center justify-center px-6 py-3 text-base font-semibold rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors #{'opacity-50 pointer-events-none' if @next_opportunity_id.blank?}",
        data: { turbo_frame: "opportunities_stack" } do %>
        Next
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      <% end %>
    </div>

    <% if @remaining_count && @remaining_count > 0 %>
      <div class="mt-3 text-center text-sm text-gray-500 dark:text-gray-400">
        +<%= @remaining_count %> more <%= "opportunity".pluralize(@remaining_count) %>
      </div>
    <% end %>
  </div>
<% else %>
  <%= render "opportunities/empty_state" %>
<% end %>
