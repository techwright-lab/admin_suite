<% show_actions = local_assigns.fetch(:show_actions, false) %>

<div class="p-6 sm:p-8">
  <!-- Header with source badge -->
  <div class="flex items-start justify-between mb-6">
    <div class="flex items-center gap-3">
      <!-- Company initial/logo placeholder -->
      <div
        class="
          w-14 h-14 rounded-xl bg-gradient-to-br from-indigo-500
          to-purple-600 flex items-center justify-center text-white text-xl
          font-bold shadow-lg
        "
      >
        <%= opportunity.company_name&.first&.upcase || "?" %>
      </div>

      <div>
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">
          <%= opportunity.company_name || "Unknown Company" %>
        </h2>

        <p class="text-lg text-gray-600 dark:text-gray-300">
          <%= opportunity.job_role_title || "Position" %>
        </p>
      </div>
    </div>

    <!-- Source badge -->
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium <%= opportunity.status_badge_classes %>">
      <% case opportunity.source_type %>
      <% when "linkedin_forward" %>
        <svg class="w-3.5 h-3.5 mr-1.5" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
          />
        </svg>
        LinkedIn
      <% when "referral" %>
        <svg
          class="w-3.5 h-3.5 mr-1.5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"
          />
        </svg>
        Referral
      <% else %>
        <svg
          class="w-3.5 h-3.5 mr-1.5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
          />
        </svg>
        Email
      <% end %>
    </span>
  </div>

  <!-- Key Details -->
  <% if opportunity.key_details.present? %>
    <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
      <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
        Key Details
      </h3>

      <p class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
        <%= opportunity.key_details %>
      </p>
    </div>
  <% elsif opportunity.email_snippet.present? %>
    <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
      <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
        Email Preview
      </h3>

      <p
        class="
          text-gray-600 dark:text-gray-400 text-sm leading-relaxed
          line-clamp-3
        "
      >
        <%= opportunity.email_snippet %>
      </p>
    </div>
  <% end %>

  <!-- Recruiter Info -->
  <% if opportunity.recruiter_display.present? %>
    <div class="mb-6 flex items-center gap-3">
      <div
        class="
          w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-600 flex
          items-center justify-center
        "
      >
        <svg
          class="w-5 h-5 text-gray-500 dark:text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
          />
        </svg>
      </div>

      <div>
        <p class="text-sm font-medium text-gray-900 dark:text-white">
          <%= opportunity.recruiter_name || opportunity.recruiter_email %>
        </p>

        <% if opportunity.recruiter_company.present? %>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            <%= opportunity.recruiter_company %>
          </p>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Job URL Section -->
  <div class="mb-6">
    <% if opportunity.has_job_url? %>
      <div
        class="
          flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20
          rounded-lg
        "
      >
        <svg
          class="w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
          />
        </svg>

        <a
          href="<%= opportunity.job_url %>"
          target="_blank"
          rel="noopener"
          class="
            text-sm text-green-700 dark:text-green-300 hover:underline
            truncate
          "
        >
          <%= opportunity.job_url.truncate(50) %>
        </a>
      </div>
    <% else %>
      <!-- Manual URL entry -->
      <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
        <p class="text-sm text-yellow-800 dark:text-yellow-200 mb-3">
          No job listing URL found. Add one to get full job details:
        </p>

        <%= form_with url: update_url_opportunity_path(opportunity), method: :patch, class: "flex gap-2", data: { turbo: true } do |f| %>
          <%= f.text_field :job_url, 
              placeholder: "https://...", 
              class: "flex-1 px-3 py-2 text-sm rounded-lg border border-yellow-300 dark:border-yellow-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent" %>

          <%= f.submit "Add", class: "px-4 py-2 text-sm font-medium bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors cursor-pointer" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Extracted Links -->
  <% if opportunity.has_extracted_links? %>
    <div class="mb-6">
      <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
        Related Links
      </h3>

      <div class="space-y-2">
        <% opportunity.parsed_links.first(3).each do |link| %>
          <a
            href="<%= link[:url] %>"
            target="_blank"
            rel="noopener"
            class="
              flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100
              dark:hover:bg-gray-700 transition-colors
            "
          >
            <svg
              class="w-4 h-4 text-gray-400 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
              />
            </svg>

            <span class="text-sm text-gray-600 dark:text-gray-400 truncate">
              <%= link[:description] || link[:url].truncate(40) %>
            </span>

            <span
              class="
                text-xs px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-600
                text-gray-500 dark:text-gray-400
              "
            >
              <%= link[:type]&.humanize || "Link" %>
            </span>
          </a>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Action Buttons -->
  <% if show_actions %>
    <div class="flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
      <%= button_to ignore_opportunity_path(opportunity), 
          method: :post,
          class: "flex-1 inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-xl text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200",
          data: { 
            turbo: true,
            turbo_method: :post,
            action: "opportunities#ignore"
          } do %>
        <svg
          class="w-5 h-5 mr-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
        Ignore
      <% end %>

      <%= button_to apply_opportunity_path(opportunity),
          method: :post,
          class: "flex-1 inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-xl text-white bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 shadow-lg hover:shadow-xl transition-all duration-200",
          data: { 
            turbo: true,
            turbo_method: :post,
            action: "opportunities#apply"
          } do %>
        <svg
          class="w-5 h-5 mr-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          />
        </svg>
        Apply
      <% end %>
    </div>
  <% end %>
</div>
