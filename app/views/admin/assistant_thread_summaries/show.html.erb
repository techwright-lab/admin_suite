<% content_for :title, "Thread Summary ##{@summary.id} - Admin" %>

<div class="px-4 sm:px-6 lg:px-8 max-w-5xl">
  <%= render "admin/shared/page_header",
      title: "Thread Summary ##{@summary.id}",
      description: "Conversation summary for Thread ##{@summary.thread_id}",
      breadcrumbs: [
        { label: "Thread Summaries", path: admin_assistant_thread_summaries_path },
        { label: "##{@summary.id}" }
      ] %>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Summary Details -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Summary Details</h2>
          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400">
            Version <%= @summary.summary_version %>
          </span>
        </div>
        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <div>
            <dt class="text-slate-500 dark:text-slate-400">Created at</dt>
            <dd class="mt-1 font-medium text-slate-900 dark:text-white"><%= @summary.created_at.strftime("%Y-%m-%d %H:%M:%S") %></dd>
          </div>
          <div>
            <dt class="text-slate-500 dark:text-slate-400">Updated at</dt>
            <dd class="mt-1 font-medium text-slate-900 dark:text-white"><%= @summary.updated_at.strftime("%Y-%m-%d %H:%M:%S") %></dd>
          </div>
          <div>
            <dt class="text-slate-500 dark:text-slate-400">Last Summarized Message</dt>
            <dd class="mt-1 font-medium text-slate-900 dark:text-white">
              <% if @summary.last_summarized_message_id.present? %>
                #<%= @summary.last_summarized_message_id %>
              <% else %>
                —
              <% end %>
            </dd>
          </div>
          <div>
            <dt class="text-slate-500 dark:text-slate-400">Summary Length</dt>
            <dd class="mt-1 font-medium text-slate-900 dark:text-white"><%= @summary.summary_text.length %> characters</dd>
          </div>
        </dl>
      </div>

      <!-- Summary Text -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
        <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Summary Text</h2>
        <div class="prose prose-sm dark:prose-invert max-w-none">
          <pre class="text-sm bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 rounded-lg p-4 overflow-x-auto whitespace-pre-wrap max-h-96 overflow-y-auto"><%= @summary.summary_text.presence || "(empty)" %></pre>
        </div>
      </div>

      <!-- Last Summarized Message (if available) -->
      <% if @summary.last_summarized_message.present? %>
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
          <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Last Summarized Message</h2>
          <div class="p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/30">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-slate-900 dark:text-white"><%= @summary.last_summarized_message.role.titleize %></span>
              <span class="text-xs text-slate-500 dark:text-slate-400"><%= @summary.last_summarized_message.created_at.strftime("%Y-%m-%d %H:%M:%S") %></span>
            </div>
            <pre class="text-sm bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-3 overflow-x-auto whitespace-pre-wrap max-h-48 overflow-y-auto"><%= @summary.last_summarized_message.content.truncate(1000) %></pre>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
        <h3 class="text-sm font-semibold text-slate-900 dark:text-white mb-4">Related Objects</h3>
        <dl class="space-y-3 text-sm">
          <div>
            <dt class="text-slate-500 dark:text-slate-400">Thread</dt>
            <dd class="mt-1">
              <%= link_to "##{@summary.thread_id}", admin_assistant_thread_path(@summary.thread_id), class: "text-amber-600 dark:text-amber-400 hover:underline" %>
            </dd>
          </div>
          <div>
            <dt class="text-slate-500 dark:text-slate-400">User</dt>
            <dd class="mt-1 text-slate-900 dark:text-white"><%= @summary.thread&.user&.email_address || "—" %></dd>
          </div>
          <div>
            <dt class="text-slate-500 dark:text-slate-400">LLM Log</dt>
            <dd class="mt-1">
              <% if @summary.llm_api_log_id.present? %>
                <%= link_to "##{@summary.llm_api_log_id}", admin_ai_llm_api_log_path(@summary.llm_api_log_id), class: "text-amber-600 dark:text-amber-400 hover:underline" %>
              <% else %>
                <span class="text-slate-500">—</span>
              <% end %>
            </dd>
          </div>
        </dl>
      </div>

      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
        <h3 class="text-sm font-semibold text-slate-900 dark:text-white mb-4">Quick Links</h3>
        <div class="space-y-2 text-sm">
          <a href="<%= admin_assistant_thread_path(@summary.thread_id) %>" class="flex items-center gap-2 text-amber-600 dark:text-amber-400 hover:underline">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            View Thread
          </a>
          <% if @summary.llm_api_log_id.present? %>
            <a href="<%= admin_ai_llm_api_log_path(@summary.llm_api_log_id) %>" class="flex items-center gap-2 text-amber-600 dark:text-amber-400 hover:underline">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              View LLM API Log
            </a>
          <% end %>
          <a href="<%= admin_assistant_turns_path(thread_id: @summary.thread_id) %>" class="flex items-center gap-2 text-amber-600 dark:text-amber-400 hover:underline">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Turns for this thread
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
