<% content_for :title, "Interview Applications - Admin" %>

<div class="px-4 sm:px-6 lg:px-8">
  <%= render "admin/shared/page_header",
      title: "Interview Applications",
      description: "View all interview applications across users" %>

  <%= render "admin/shared/stats_grid",
      stats: {
        total: @stats[:total],
        active: @stats[:by_status]["active"] || 0,
        archived: @stats[:by_status]["archived"] || 0,
        with_rounds: @stats[:with_rounds]
      },
      colors: {
        total: "text-slate-900 dark:text-white",
        active: "text-green-600 dark:text-green-400",
        archived: "text-slate-600 dark:text-slate-400",
        with_rounds: "text-blue-600 dark:text-blue-400"
      },
      columns: 4,
      grid_class: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" %>

  <div class="flex flex-col lg:flex-row gap-6">
    <%= render "admin/shared/filter_sidebar",
        url: admin_interview_applications_path,
        filters: [
          {
            type: :text,
            name: :search,
            label: "Search",
            placeholder: "User, company, role...",
            value: @filters[:search]
          },
          {
            type: :select,
            name: :status,
            label: "Status",
            options: [
              ["All", ""],
              ["Active", "active"],
              ["Archived", "archived"],
              ["Rejected", "rejected"],
              ["Accepted", "accepted"]
            ],
            value: @filters[:status]
          },
          {
            type: :select,
            name: :pipeline_stage,
            label: "Pipeline Stage",
            options: [
              ["All", ""],
              ["Applied", "applied"],
              ["Screening", "screening"],
              ["Interviewing", "interviewing"],
              ["Offer", "offer"],
              ["Closed", "closed"]
            ],
            value: @filters[:pipeline_stage]
          },
          {
            type: :select,
            name: :sort,
            label: "Sort By",
            options: [
              ["Recently Created", "recent"],
              ["Applied Date", "applied_at"],
              ["User Name", "user"]
            ],
            value: @filters[:sort]
          }
        ] %>

    <div class="flex-1 min-w-0">
      <%= render "admin/shared/data_table",
          collection: @interview_applications,
          columns: [
            {
              header: "Application",
              content: ->(app) do
                content_tag(:div) do
                  content_tag(:p, "#{app.company.name} â€¢ #{app.job_role.title}", class: "text-sm font-medium text-slate-900 dark:text-white") +
                  content_tag(:p, app.user.display_name, class: "text-xs text-slate-500 dark:text-slate-400")
                end
              end
            },
            {
              header: "Status",
              content: ->(app) do
                render "admin/shared/status_badge", status: app.status, custom_colors: {
                  "active" => "bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",
                  "archived" => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300",
                  "rejected" => "bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",
                  "accepted" => "bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400"
                }
              end,
              class: "whitespace-nowrap"
            },
            {
              header: "Pipeline",
              content: ->(app) do
                render "admin/shared/status_badge", status: app.pipeline_stage, custom_colors: {
                  "applied" => "bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",
                  "screening" => "bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-400",
                  "interviewing" => "bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400",
                  "offer" => "bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",
                  "closed" => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"
                }
              end,
              class: "whitespace-nowrap"
            },
            {
              header: "Rounds",
              content: ->(app) { app.interview_rounds.count },
              class: "whitespace-nowrap text-sm text-slate-600 dark:text-slate-400"
            },
            {
              header: "Actions",
              content: ->(app) do
                link_to("View", admin_interview_application_path(app), class: "text-amber-600 hover:text-amber-800 dark:text-amber-400 font-medium")
              end,
              class: "whitespace-nowrap text-sm"
            }
          ],
          empty_message: "No interview applications found" %>

      <%= render "admin/shared/pagination", pagy: @pagy %>
    </div>
  </div>
</div>
