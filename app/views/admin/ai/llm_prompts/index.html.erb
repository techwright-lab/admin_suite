<% content_for :title, "LLM Prompts - Admin" %>

<div class="px-4 sm:px-6 lg:px-8">
  <%= render "admin/shared/page_header",
      title: "LLM Prompt Templates",
      description: "Manage AI extraction prompt templates for different operations",
      actions: link_to("New Prompt", new_admin_ai_llm_prompt_path, class: "px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white text-sm font-medium rounded-lg transition-colors") %>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6">
    <div
      class="
        bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200
        dark:border-slate-700
      "
    >
      <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase">
        Total
      </p>

      <p class="text-2xl font-bold text-slate-900 dark:text-white">
        <%= @stats[:total] %>
      </p>
    </div>

    <div
      class="
        bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200
        dark:border-slate-700
      "
    >
      <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase">
        Active
      </p>

      <p class="text-2xl font-bold text-green-600 dark:text-green-400">
        <%= @stats[:active] %>
      </p>
    </div>

    <div
      class="
        bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200
        dark:border-slate-700
      "
    >
      <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase">
        Inactive
      </p>

      <p class="text-2xl font-bold text-slate-600 dark:text-slate-400">
        <%= @stats[:inactive] %>
      </p>
    </div>

    <div
      class="
        bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200
        dark:border-slate-700
      "
    >
      <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase">
        By Type
      </p>

      <div class="text-sm text-slate-600 dark:text-slate-400 mt-1">
        <% @stats[:by_type].each do |type, count| %>
          <span class="inline-block mr-2"><%= type %>: <%= count %></span>
        <% end %>
      </div>
    </div>
  </div>

  <div class="flex flex-col lg:flex-row gap-6">
    <!-- Filters Sidebar -->
    <div class="lg:w-64 flex-shrink-0">
      <div
        class="
          bg-white dark:bg-slate-800 rounded-xl shadow-sm border
          border-slate-200 dark:border-slate-700 p-4
        "
      >
        <h3 class="text-sm font-semibold text-slate-900 dark:text-white mb-4">
          Filters
        </h3>

        <%= form_with url: admin_ai_llm_prompts_path, method: :get, local: true, class: "space-y-4" do |f| %>
          <div>
            <label
              class="
                block text-xs font-medium text-slate-500 dark:text-slate-400
                mb-1
              "
            >
              Search
            </label>

            <input
              type="text"
              name="search"
              value="<%= @filters[:search] %>"
              placeholder="Name or description..."
              class="
                w-full rounded-lg border-slate-300 dark:border-slate-600
                dark:bg-slate-700 dark:text-white text-sm
              "
            >
          </div>

          <div>
            <label
              class="
                block text-xs font-medium text-slate-500 dark:text-slate-400
                mb-1
              "
            >
              Prompt Type
            </label>

            <select
              name="prompt_type"
              class="
                w-full rounded-lg border-slate-300 dark:border-slate-600
                dark:bg-slate-700 dark:text-white text-sm
              "
            >
              <option value="">All Types</option>

              <option
                value="job_extraction"
                <%= "selected" if @filters[:prompt_type] == "job_extraction" %>
              >
                Job Extraction
              </option>

              <option
                value="email_extraction"
                <%= "selected" if @filters[:prompt_type] == "email_extraction" %>
              >
                Email Extraction
              </option>

              <option
                value="resume_extraction"
                <%= "selected" if @filters[:prompt_type] == "resume_extraction" %>
              >
                Resume Extraction
              </option>
            </select>
          </div>

          <div>
            <label
              class="
                block text-xs font-medium text-slate-500 dark:text-slate-400
                mb-1
              "
            >
              Status
            </label>

            <select
              name="active"
              class="
                w-full rounded-lg border-slate-300 dark:border-slate-600
                dark:bg-slate-700 dark:text-white text-sm
              "
            >
              <option value="">All</option>

              <option
                value="true"
                <%= "selected" if @filters[:active] == "true" %>
              >
                Active
              </option>

              <option
                value="false"
                <%= "selected" if @filters[:active] == "false" %>
              >
                Inactive
              </option>
            </select>
          </div>

          <div>
            <label
              class="
                block text-xs font-medium text-slate-500 dark:text-slate-400
                mb-1
              "
            >
              Sort By
            </label>

            <select
              name="sort"
              class="
                w-full rounded-lg border-slate-300 dark:border-slate-600
                dark:bg-slate-700 dark:text-white text-sm
              "
            >
              <option value="">Type & Version</option>

              <option
                value="name"
                <%= "selected" if @filters[:sort] == "name" %>
              >
                Name (A-Z)
              </option>

              <option
                value="version"
                <%= "selected" if @filters[:sort] == "version" %>
              >
                Version (Newest)
              </option>

              <option
                value="recent"
                <%= "selected" if @filters[:sort] == "recent" %>
              >
                Recently Added
              </option>
            </select>
          </div>

          <div class="flex gap-2 pt-2">
            <button
              type="submit"
              class="
                flex-1 px-3 py-2 bg-amber-500 hover:bg-amber-600 text-white
                text-sm font-medium rounded-lg transition-colors
              "
            >
              Apply
            </button>

            <%= link_to "Clear", admin_ai_llm_prompts_path, class: "flex-1 px-3 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 text-sm font-medium rounded-lg text-center transition-colors" %>
          </div>
        <% end %>

        <!-- Quick Actions -->
        <div class="mt-6 pt-4 border-t border-slate-200 dark:border-slate-700">
          <h4
            class="
              text-xs font-semibold text-slate-500 dark:text-slate-400
              uppercase tracking-wider mb-3
            "
          >
            Create New
          </h4>

          <div class="space-y-2">
            <%= link_to "Job Extraction", new_admin_ai_llm_prompt_path(prompt_type: "job_extraction"), class: "block px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" %>
            <%= link_to "Email Extraction", new_admin_ai_llm_prompt_path(prompt_type: "email_extraction"), class: "block px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" %>
            <%= link_to "Resume Extraction", new_admin_ai_llm_prompt_path(prompt_type: "resume_extraction"), class: "block px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 min-w-0">
      <div
        class="
          bg-white dark:bg-slate-800 rounded-xl shadow-sm border
          border-slate-200 dark:border-slate-700 overflow-hidden
        "
      >
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
            <thead class="bg-slate-50 dark:bg-slate-900">
              <tr>
                <th
                  class="
                    px-4 py-3 text-left text-xs font-medium text-slate-500
                    dark:text-slate-400 uppercase tracking-wider
                  "
                >
                  Template
                </th>

                <th
                  class="
                    px-4 py-3 text-left text-xs font-medium text-slate-500
                    dark:text-slate-400 uppercase tracking-wider
                  "
                >
                  Type
                </th>

                <th
                  class="
                    px-4 py-3 text-left text-xs font-medium text-slate-500
                    dark:text-slate-400 uppercase tracking-wider
                  "
                >
                  Status
                </th>

                <th
                  class="
                    px-4 py-3 text-left text-xs font-medium text-slate-500
                    dark:text-slate-400 uppercase tracking-wider
                  "
                >
                  Version
                </th>

                <th
                  class="
                    px-4 py-3 text-left text-xs font-medium text-slate-500
                    dark:text-slate-400 uppercase tracking-wider
                  "
                >
                  Variables
                </th>

                <th
                  class="
                    px-4 py-3 text-left text-xs font-medium text-slate-500
                    dark:text-slate-400 uppercase tracking-wider
                  "
                >
                  Actions
                </th>
              </tr>
            </thead>

            <tbody
              class="
                bg-white dark:bg-slate-800 divide-y divide-slate-200
                dark:divide-slate-700
              "
            >
              <% @prompts.each do |prompt| %>
                <tr
                  class="
                    hover:bg-slate-50 dark:hover:bg-slate-700/50
                    transition-colors
                  "
                >
                  <td class="px-4 py-3">
                    <div>
                      <p class="text-sm font-medium text-slate-900 dark:text-white">
                        <%= prompt.name %>
                      </p>

                      <% if prompt.description.present? %>
                        <p
                          class="
                            text-xs text-slate-500 dark:text-slate-400 mt-1
                            truncate max-w-md
                          "
                        >
                          <%= prompt.description %>
                        </p>
                      <% end %>
                    </div>
                  </td>

                  <td class="px-4 py-3 whitespace-nowrap">
                    <% type_colors = {
                      "Ai::JobExtractionPrompt" => "bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",
                      "Ai::EmailExtractionPrompt" => "bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400",
                      "Ai::ResumeSkillExtractionPrompt" => "bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400"
                    } %>

                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= type_colors[prompt.type] || 'bg-slate-100 text-slate-800' %>">
                      <%= prompt.prompt_type_name %>
                    </span>
                  </td>

                  <td class="px-4 py-3 whitespace-nowrap">
                    <% if prompt.active? %>
                      <span
                        class="
                          px-2 inline-flex text-xs leading-5 font-semibold
                          rounded-full bg-green-100 text-green-800
                          dark:bg-green-900/20 dark:text-green-400
                        "
                      >
                        Active
                      </span>
                    <% else %>
                      <span
                        class="
                          px-2 inline-flex text-xs leading-5 font-semibold
                          rounded-full bg-slate-100 text-slate-800
                          dark:bg-slate-700 dark:text-slate-300
                        "
                      >
                        Inactive
                      </span>
                    <% end %>
                  </td>

                  <td
                    class="
                      px-4 py-3 whitespace-nowrap text-sm text-slate-500
                      dark:text-slate-400
                    "
                  >
                    v<%= prompt.version %>
                  </td>

                  <td
                    class="
                      px-4 py-3 whitespace-nowrap text-sm text-slate-500
                      dark:text-slate-400
                    "
                  >
                    <% vars = prompt.template_variables %>

                    <% if vars.any? %>
                      <span title="<%= vars.join(", ") %>">
                        <%= vars.size %> vars
                      </span>
                    <% else %>
                      <span class="text-slate-400">None</span>
                    <% end %>
                  </td>

                  <td class="px-4 py-3 whitespace-nowrap text-sm">
                    <div class="flex items-center gap-2">
                      <%= link_to "View", admin_ai_llm_prompt_path(prompt), class: "text-amber-600 hover:text-amber-800 dark:text-amber-400 font-medium" %>
                      <%= link_to "Edit", edit_admin_ai_llm_prompt_path(prompt), class: "text-slate-600 hover:text-slate-800 dark:text-slate-400 font-medium" %>
                    </div>
                  </td>
                </tr>
              <% end %>

              <% if @prompts.empty? %>
                <tr>
                  <td
                    colspan="6"
                    class="
                      px-4 py-8 text-center text-sm text-slate-500
                      dark:text-slate-400
                    "
                  >
                    No prompt templates found
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <%= render "admin/shared/pagination", pagy: @pagy %>
      </div>
    </div>
  </div>
</div>
