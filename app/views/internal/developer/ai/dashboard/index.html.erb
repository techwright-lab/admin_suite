<% content_for :title, "AI Portal - Developer" %>

<div class="px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <nav class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2">
      <%= link_to "Developer Portal", internal_developer_root_path, class: "hover:text-cyan-600 dark:hover:text-cyan-400" %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <span class="text-slate-900 dark:text-white">AI Portal</span>
    </nav>
    <div class="flex items-center gap-3">
      <div class="flex items-center justify-center w-10 h-10 rounded-xl bg-cyan-100 dark:bg-cyan-900/30">
        <svg class="w-5 h-5 text-cyan-600 dark:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
        </svg>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">AI Portal</h1>
        <p class="text-sm text-slate-500 dark:text-slate-400">LLM & Machine Learning Management</p>
      </div>
    </div>
  </div>

  <!-- Health & Charts Row -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8">
    <!-- LLM API Health -->
    <%= health_card("LLM API", @health[:status], metrics: {
      "24h calls" => @health[:total],
      "success rate" => "#{@health[:success_rate]}%",
      "avg latency" => "#{@health[:avg_latency]}ms",
      "24h cost" => "$#{@health[:total_cost]}"
    }) %>

    <!-- API Calls Chart -->
    <%= chart_card("API Calls (7 days)", @charts[:api_calls], 
          color: :cyan, 
          total: Ai::LlmApiLog.where("created_at > ?", 7.days.ago).count) %>

    <!-- Cost Chart -->
    <%= chart_card("Cost (7 days, cents)", @charts[:cost], 
          color: :green, 
          total: "$#{((Ai::LlmApiLog.where("created_at > ?", 7.days.ago).sum(:estimated_cost_cents) || 0) / 100.0).round(2)}") %>
  </div>

  <!-- Quick Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
    <%= stat_card("LLM Prompts", @stats[:llm_prompts]) %>
    <%= stat_card("Active Prompts", @stats[:active_prompts], color: :green) %>
    <%= stat_card("Provider Configs", @stats[:provider_configs]) %>
    <%= stat_card("Enabled Providers", @stats[:enabled_providers], color: :green) %>
    <%= stat_card("Total Tokens (24h)", number_to_human(@health[:total_tokens]), color: :cyan) %>
    <%= stat_card("Resources", @stats[:total_resources], color: :cyan) %>
  </div>

  <!-- LLM Management Grid -->
  <div class="mb-8">
    <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">LLM Management</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <%= link_to internal_developer_ai_llm_prompts_path, class: "group bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 hover:border-cyan-300 dark:hover:border-cyan-700 transition-colors" do %>
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-slate-900 dark:text-white group-hover:text-cyan-600 dark:group-hover:text-cyan-400">LLM Prompts</h3>
          <span class="text-2xl font-bold text-slate-200 dark:text-slate-700 group-hover:text-cyan-200 dark:group-hover:text-cyan-800"><%= @stats[:llm_prompts] %></span>
        </div>
        <p class="text-sm text-slate-500 dark:text-slate-400">Manage prompt templates for AI models</p>
        <div class="flex gap-2 mt-4">
          <span class="px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400">
            <%= @stats[:active_prompts] %> Active
          </span>
          <span class="px-2 py-1 text-xs rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400">
            <%= @stats[:llm_prompts] - @stats[:active_prompts] %> Inactive
          </span>
        </div>
      <% end %>

      <%= link_to internal_developer_ai_llm_provider_configs_path, class: "group bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 hover:border-cyan-300 dark:hover:border-cyan-700 transition-colors" do %>
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-slate-900 dark:text-white group-hover:text-cyan-600 dark:group-hover:text-cyan-400">Provider Configs</h3>
          <span class="text-2xl font-bold text-slate-200 dark:text-slate-700 group-hover:text-cyan-200 dark:group-hover:text-cyan-800"><%= @stats[:provider_configs] %></span>
        </div>
        <p class="text-sm text-slate-500 dark:text-slate-400">Configure LLM providers (OpenAI, Anthropic, etc.)</p>
        <div class="flex gap-2 mt-4">
          <span class="px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400">
            <%= @stats[:enabled_providers] %> Enabled
          </span>
          <span class="px-2 py-1 text-xs rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400">
            <%= @stats[:provider_configs] - @stats[:enabled_providers] %> Disabled
          </span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Recent Activity & Logs -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-8">
    <!-- Recent API Logs -->
    <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
        <h3 class="font-semibold text-slate-900 dark:text-white">Recent API Calls</h3>
        <%= link_to "View all â†’", internal_developer_ai_llm_api_logs_path, class: "text-sm text-cyan-600 dark:text-cyan-400 hover:underline" %>
      </div>
      <div class="divide-y divide-slate-100 dark:divide-slate-700">
        <% @recent[:api_logs].each do |log| %>
          <div class="px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700/50">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full <%= log.status == 'success' ? 'bg-green-500' : 'bg-red-500' %>"></span>
                <span class="text-sm font-medium text-slate-900 dark:text-white"><%= log.provider %></span>
                <span class="text-xs text-slate-500 dark:text-slate-400"><%= log.model %></span>
              </div>
              <div class="text-right">
                <span class="text-xs text-slate-500"><%= log.latency_ms %>ms</span>
                <span class="text-xs text-slate-400 ml-2"><%= time_ago_in_words(log.created_at) %> ago</span>
              </div>
            </div>
          </div>
        <% end %>
        <% if @recent[:api_logs].empty? %>
          <div class="px-4 py-6 text-center text-sm text-slate-500">No recent API calls</div>
        <% end %>
      </div>
    </div>

    <!-- Recently Updated Prompts -->
    <%= recent_items_card("Recently Updated Prompts", @recent[:prompts],
          title_field: :name,
          badge_field: :type,
          view_all_path: internal_developer_ai_llm_prompts_path) %>
  </div>

  <!-- Logs Section -->
  <div class="mb-8">
    <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Logs & Debugging</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <%= link_to internal_developer_ai_llm_api_logs_path, class: "group bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 hover:border-cyan-300 dark:hover:border-cyan-700 transition-colors" do %>
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-slate-900 dark:text-white group-hover:text-cyan-600 dark:group-hover:text-cyan-400">LLM API Logs</h3>
          <span class="text-2xl font-bold text-slate-200 dark:text-slate-700 group-hover:text-cyan-200 dark:group-hover:text-cyan-800"><%= @stats[:api_logs] %></span>
        </div>
        <p class="text-sm text-slate-500 dark:text-slate-400">View all LLM API requests and responses</p>
        <div class="flex gap-2 mt-4">
          <span class="px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400">
            <%= @health[:successful] %> Success (24h)
          </span>
          <span class="px-2 py-1 text-xs rounded-full bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400">
            <%= @health[:failed] %> Failed (24h)
          </span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Quick Links to Assistant Portal -->
  <div class="bg-gradient-to-r from-cyan-50 to-violet-50 dark:from-cyan-900/20 dark:to-violet-900/20 rounded-xl border border-cyan-200 dark:border-cyan-800/50 p-6">
    <h3 class="font-semibold text-cyan-900 dark:text-cyan-100 mb-4">Related: Assistant Portal</h3>
    <p class="text-sm text-cyan-700 dark:text-cyan-300 mb-4">View and manage AI assistant conversations and tool executions.</p>
    <%= link_to internal_developer_assistant_root_path, class: "inline-flex items-center gap-2 px-4 py-2 bg-violet-600 hover:bg-violet-700 text-white text-sm font-medium rounded-lg transition-colors" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
      </svg>
      Go to Assistant Portal
    <% end %>
  </div>
</div>
