# CI Runbook (GitHub Actions)

## Scope

- GitHub Actions workflow: `.github/workflows/ci.yml`
- Triggers:
  - Pull requests
  - Pushes to `main`

## What CI runs

From `.github/workflows/ci.yml`:

- **Security scans**
  - Brakeman: `bin/brakeman --no-pager`
  - Bundler Audit: `bin/bundler-audit`
  - Importmap audit (JS): `bin/importmap audit`
- **Linting**
  - RuboCop: `bin/rubocop -f github`
- **Tests**
  - `bin/rails db:test:prepare test`
  - `bin/rails db:test:prepare test:system`

CI uses an ephemeral PostgreSQL service container for repeatable test runs.

## How to respond to CI failures

1. Open the failing GitHub Actions run attached to the PR/commit.
2. Identify the failing job: `scan_ruby`, `scan_js`, `lint`, `test`, or `system-test`.
3. Reproduce locally when possible:

```bash
bin/brakeman --no-pager
bin/bundler-audit
bin/importmap audit
bin/rubocop
bin/rails test
```

4. Fix on the feature branch and push.
5. Verify CI is green before merge.

## Merge gating (recommended controls)

- Require PR review(s) before merge
- Require all CI checks to pass before merge
- Restrict direct pushes to `main`

