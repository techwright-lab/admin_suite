<%# Admin Suite Sidebar - mirrors internal/developer styling %>

<% sorted_portals = navigation_items.sort_by { |(_key, meta)| (meta[:order] || 100).to_i } %>

<aside class="flex flex-col w-72 bg-gradient-to-b from-indigo-900 via-indigo-800 to-purple-900 h-full">
  <!-- Header -->
  <div class="flex items-center justify-between h-16 px-4 border-b border-indigo-700/50">
    <%= link_to root_path, class: "flex items-center gap-3" do %>
      <div class="flex items-center justify-center w-9 h-9 rounded-lg bg-indigo-500/30 border border-indigo-400/30">
        <svg class="w-5 h-5 text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
        </svg>
      </div>
      <div>
        <span class="text-lg font-bold text-white">Developer</span>
        <span class="block text-xs text-indigo-300">Admin Suite</span>
      </div>
    <% end %>
  </div>

  <!-- Quick Links -->
  <div class="px-3 py-3 border-b border-indigo-700/50">
    <div class="flex gap-2">
      <%= link_to root_path,
          class: "flex-1 px-3 py-2 text-xs font-medium text-indigo-200 bg-indigo-800/50 rounded-lg hover:bg-indigo-700/50 text-center transition-colors" do %>
        Dashboard
      <% end %>
      <% docs_path = (main_app.internal_developer_docs_path rescue nil) %>
      <% if docs_path.present? %>
        <%= link_to docs_path,
            class: "flex-1 px-3 py-2 text-xs font-medium text-indigo-200 bg-indigo-800/50 rounded-lg hover:bg-indigo-700/50 text-center transition-colors" do %>
          Docs
        <% end %>
      <% else %>
        <span class="flex-1 px-3 py-2 text-xs font-medium text-indigo-300/60 bg-indigo-800/30 rounded-lg text-center">
          Docs
        </span>
      <% end %>
    </div>
  </div>

  <!-- Portal Navigation -->
  <nav class="flex-1 overflow-y-auto px-3 py-4 space-y-2">
    <% sorted_portals.each do |portal_key, portal| %>
      <% portal_home = portal_path(portal: portal_key) %>
      <% portal_prefix = File.join(request.script_name.to_s, portal_key.to_s) %>
      <% active = request.path.start_with?(portal_prefix) %>
      <% color = portal_color(portal_key) %>

      <div>
        <%= link_to (portal_home || root_path),
            class: "flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors #{active ? "bg-#{color}-500/20 text-white" : "text-indigo-200 hover:bg-indigo-700/30 hover:text-white"}" do %>
          <div class="flex items-center justify-center w-8 h-8 rounded-lg <%= active ? "bg-#{color}-500/30" : "bg-indigo-800/50" %>">
            <%= portal_icon(portal_key) %>
          </div>
          <span class="font-medium"><%= portal[:label] %></span>
        <% end %>

        <% if active %>
          <div class="mt-1 ml-11 space-y-0.5 text-sm">
            <% portal[:sections].sort_by { |(_k, s)| s[:label].to_s }.each do |_section_key, section| %>
              <div class="text-xs font-medium text-indigo-400/70 uppercase tracking-wider px-3 pt-2 pb-1">
                <%= section[:label] %>
              </div>
              <% section[:items].sort_by { |it| it[:label].to_s }.each do |item| %>
                <% item_active = request.path.start_with?(item[:path].to_s) %>
                <%= link_to item[:label], item[:path],
                    class: "block px-3 py-1.5 rounded #{item_active ? 'text-white bg-indigo-700/50' : 'text-indigo-300 hover:text-white'}",
                    data: { turbo_frame: "_top" } %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </nav>

  <!-- Footer -->
  <div class="p-3 border-t border-indigo-700/50">
    <div class="px-3 py-2 text-xs text-indigo-400">
      <div class="flex items-center justify-between">
        <span>Admin Suite</span>
        <span class="font-medium text-indigo-300"><%= sorted_portals.size %> Portals</span>
      </div>
    </div>
  </div>
</aside>
